import{e as M,u as _,r,j as t}from"./index-CFxg3Tr1.js";import{f as D,g as L}from"./index-CqA6Po1E.js";import{a as I,s as P,g as E}from"./session-BuNBObg0.js";const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function V(e,n=0){return(a[e[n+0]]+a[e[n+1]]+a[e[n+2]]+a[e[n+3]]+"-"+a[e[n+4]]+a[e[n+5]]+"-"+a[e[n+6]]+a[e[n+7]]+"-"+a[e[n+8]]+a[e[n+9]]+"-"+a[e[n+10]]+a[e[n+11]]+a[e[n+12]]+a[e[n+13]]+a[e[n+14]]+a[e[n+15]]).toLowerCase()}let g;const A=new Uint8Array(16);function B(){if(!g){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");g=crypto.getRandomValues.bind(crypto)}return g(A)}const O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),C={randomUUID:O};function $(e,n,o){var c;if(C.randomUUID&&!e)return C.randomUUID();e=e||{};const l=e.random??((c=e.rng)==null?void 0:c.call(e))??B();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,V(l)}function W(){var R;const e=M(),o=((R=_().state)==null?void 0:R.query)||"",[l,c]=r.useState([]),[x,y]=r.useState(o),[b,w]=r.useState(!1),h=r.useRef(null),v=r.useRef(null),j=r.useRef(null),N=r.useRef(!1);r.useEffect(()=>{const s=(d,u,i,p=!0)=>{let m=0;const f=p?1:-1;E.to({},{duration:i,repeat:-1,ease:"none",onUpdate:()=>{m+=f*2*Math.PI/(60*i);const k=Math.cos(m)*u,z=Math.sin(m)*u;E.set(d.current,{x:k,y:z})}})};s(v,40,10,!0),s(j,60,14,!0)},[]),r.useEffect(()=>{if(h.current){const s=h.current.parentElement;s&&(s.scrollTop=s.scrollHeight)}},[l,b]),r.useEffect(()=>{const s=[{text:"What do you feel like eating?",isUser:!1}];c(o?[...s,{text:o,isUser:!0}]:s),o&&!N.current&&(N.current=!0,U(o,!0))},[o]),r.useEffect(()=>{if(!I("chat_session_id")){const d=$();P("chat_session_id",d)}});const U=async(s,d=!1)=>{const u=s.trim();if(u){d||c(i=>[...i,{text:u,isUser:!0}]),y(""),w(!0);try{const i=I("chat_session_id"),m=await(await fetch("https://api.naimroslan.dev/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:u,sessionId:i})})).json();c(f=>[...f,{text:m.response||"Oh no, my owner must have forgeten to buy more credits ðŸ™ I'll let him know",isUser:!1}])}catch(i){console.error("Chat error:",i),c(p=>[...p,{text:"Something went wrong. Try again later.",isUser:!1}])}finally{w(!1)}}},S=()=>{U(x)},T=s=>{s.key==="Enter"&&S()};return t.jsxs("div",{className:"min-h-screen bg-light flex flex-col relative overflow-hidden",children:[t.jsxs("div",{className:"fixed inset-0 z-0 flex items-center justify-center pointer-events-none",children:[t.jsx("div",{ref:v,className:"w-[500px] h-[400px] bg-purple-300 rounded-full mix-blend-multiply blur-2xl opacity-80"}),t.jsx("div",{ref:j,className:"w-[500px] h-[400px] bg-blue-300 rounded-full mix-blend-multiply blur-2xl opacity-80 ml-[-200px] mt-[200px]"})]}),t.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl z-0"}),t.jsx("header",{className:"relative z-10 px-4 py-6 bg-transparent",children:t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsxs("div",{className:"relative flex items-center justify-center",children:[t.jsx("button",{onClick:()=>e("/"),className:"absolute left-0 p-2 -m-2",children:t.jsx(D,{size:24,className:"text-primary"})}),t.jsx("h1",{className:"text-2xl font-semibold text-primary",children:"Chat"})]})})}),t.jsx("main",{className:"flex-1 relative z-10 px-4 pb-24",children:t.jsx("div",{className:"w-full max-w-md mx-auto h-full",children:t.jsxs("div",{className:"h-full overflow-y-auto space-y-3 pr-2",children:[l.map((s,d)=>t.jsx("div",{className:`max-w-[85%] p-3 text-[15px] leading-relaxed rounded-2xl ${s.isUser?"bg-secondary text-white ml-auto rounded-br-md":"bg-primary text-light rounded-bl-md shadow-sm border border-border"}`,children:s.text},d)),b&&t.jsxs("div",{className:"bg-primary text-light px-4 py rounded-xl rounded-bl-md inline-block border border-border w-fit",children:[t.jsx("span",{className:"dot-wave",children:"."}),t.jsx("span",{className:"dot-wave animation-delay-150",children:"."}),t.jsx("span",{className:"dot-wave animation-delay-300",children:"."})]}),t.jsx("div",{ref:h})]})})}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-4 pb-6 pt-4 z-10 bg-gradient-to-t from-light via-light to-transparent",children:t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsxs("div",{className:"flex items-center bg-white rounded-full p-2 shadow-sm border border-border",children:[t.jsx("input",{type:"text",value:x,onChange:s=>y(s.target.value),onKeyPress:T,placeholder:"Ask me anything about food...",className:"flex-1 bg-transparent focus:outline-none text-primary px-3 text-[15px] font-funnel font-semibold placeholder:text-gray"}),t.jsx("button",{onClick:S,disabled:!x.trim(),className:`px-4 py-3 rounded-full text-lg transition-all ${x.trim()?"bg-primary text-white active:scale-95":"bg-muted text-gray cursor-not-allowed"}`,children:t.jsx(L,{})})]})})})]})}export{W as default};
